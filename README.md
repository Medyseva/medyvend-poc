# ğŸ¥ MedyVend - Medicine Vending Machine Ecosystem

[![Laravel Version](https://img.shields.io/badge/Laravel-8.x-red.svg)](https://laravel.com)
[![PHP Version](https://img.shields.io/badge/PHP-7.4+-blue.svg)](https://php.net)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen.svg)](https://github.com)

**MedyVend** is an intelligent IoT-enabled medicine vending machine ecosystem that provides automated, secure, and traceable medication dispensing for healthcare facilities, pharmacies, and public health centers.

---

## ğŸ“‹ Table of Contents

- [ğŸ¥ MedyVend - Medicine Vending Machine Ecosystem](#-medyvend---medicine-vending-machine-ecosystem)
  - [ğŸ“‹ Table of Contents](#-table-of-contents)
  - [ğŸ¯ Project Overview](#-project-overview)
  - [ğŸ—ï¸ System Architecture](#ï¸-system-architecture)
  - [ğŸ’¡ Key Features](#-key-features)
  - [ğŸ”§ Technology Stack](#-technology-stack)
  - [ğŸ“Š Database Schema](#-database-schema)
  - [ğŸš€ Quick Start](#-quick-start)
  - [ğŸ“ Project Structure](#-project-structure)
  - [ğŸ”Œ API Documentation](#-api-documentation)
  - [âš¡ Core Components](#-core-components)
  - [ğŸ“ˆ Data Flow](#-data-flow)
  - [ğŸ” Security Features](#-security-features)
  - [ğŸ› ï¸ Configuration](#ï¸-configuration)
  - [ğŸ“± Frontend Interface](#-frontend-interface)
  - [ğŸ”„ Background Processing](#-background-processing)
  - [ğŸ“Š Monitoring & Analytics](#-monitoring--analytics)
  - [ğŸ§ª Testing](#-testing)
  - [ğŸ“¦ Deployment](#-deployment)
  - [ğŸ” Troubleshooting](#-troubleshooting)
  - [ğŸ¤ Contributing](#-contributing)
  - [ğŸ“œ License](#-license)
  - [ğŸ‘¥ Support](#-support)

---

## ğŸ¯ Project Overview

MedyVend revolutionizes medication distribution by combining smart vending hardware with a comprehensive management system. The platform ensures secure, traceable, and efficient medicine dispensing while maintaining full compliance with pharmaceutical regulations.

### Key Benefits:
- **24/7 Automated Dispensing** - Round-the-clock medication availability
- **Inventory Management** - Real-time stock tracking and alerts
- **Audit Trail** - Complete dispensing history and compliance logging
- **Remote Monitoring** - Centralized dashboard for multiple machines
- **Integration Ready** - API-first architecture with VendTrails compatibility

---

## ğŸ—ï¸ System Architecture

### High-Level Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MedyVend Ecosystem Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Web Dashboard â”‚    â”‚   Mobile App    â”‚    â”‚   Admin Panel   â”‚             â”‚
â”‚  â”‚   (Laravel)     â”‚    â”‚  (React Native) â”‚    â”‚   (Laravel)     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                       â”‚                       â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                   â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                    API Layer (Laravel 8.x)                      â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚ VendTrails  â”‚  â”‚  Inventory  â”‚  â”‚  Dispensing â”‚  â”‚   Auth   â”‚ â”‚           â”‚
â”‚  â”‚  â”‚ Controller  â”‚  â”‚ Controller  â”‚  â”‚ Controller  â”‚  â”‚ Service  â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                   â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                Message Queue Layer (RabbitMQ)                    â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚ Dispense    â”‚  â”‚ Status      â”‚  â”‚ Inventory   â”‚  â”‚ Alert    â”‚ â”‚           â”‚
â”‚  â”‚  â”‚ Queue       â”‚  â”‚ Queue       â”‚  â”‚ Queue       â”‚  â”‚ Queue    â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                   â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                    Database Layer (MySQL)                       â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚ Machines    â”‚  â”‚ Inventory   â”‚  â”‚ Dispense    â”‚  â”‚ Audit    â”‚ â”‚           â”‚
â”‚  â”‚  â”‚ Table       â”‚  â”‚ Table       â”‚  â”‚ Records     â”‚  â”‚ Logs     â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                   â”‚                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                     Physical Hardware Layer                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                                   â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                MedyVend Hardware Platforms                       â”‚           â”‚
â”‚  â”‚                                                                   â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚           â”‚
â”‚  â”‚  â”‚   MedyVend v1   â”‚           â”‚   MedyVend v2   â”‚                â”‚           â”‚
â”‚  â”‚  â”‚ (ESP32-based)   â”‚           â”‚ (Raspberry Pi)  â”‚                â”‚           â”‚
â”‚  â”‚  â”‚   [CURRENT]     â”‚           â”‚ [IN DEVELOPMENT] â”‚               â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚           â”‚
â”‚  â”‚                                                                   â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚               Raspberry Pi 4 (Main Controller)              â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Machine Logic & Coordination                             â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Network Communication (WiFi/Ethernet)                    â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ RabbitMQ Client Integration                              â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ VendTrails API Communication                             â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ System Health Monitoring                                 â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Security & Authentication                                â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â”‚                                â”‚                                  â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚                     ESP32 Microcontroller                     â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Real-time Hardware Control                                 â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Sensor Data Collection                                     â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Motor Control & Dispensing Logic                           â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ I2C/SPI Communication with Peripherals                     â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ GPIO Management                                            â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â”‚                                â”‚                                  â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚                    Hardware Components                        â”‚ â”‚           â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  Motors & Actuators:        â”‚  Sensors & Feedback:           â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Stepper Motors (5x)      â”‚  â€¢ Load Cells (Weight)         â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Servo Motors (3x)        â”‚  â€¢ IR Sensors (Slot Detection) â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Solenoid Locks (15x)     â”‚  â€¢ Temperature Sensors         â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Conveyor Motor           â”‚  â€¢ Humidity Sensors            â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Door Actuators           â”‚  â€¢ Vibration Sensors           â”‚ â”‚           â”‚
â”‚  â”‚  â”‚                             â”‚  â€¢ Camera Module (QR Scanner)  â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  Power & Control:           â”‚  â€¢ Status LEDs                 â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ 24V DC Power Supply      â”‚  â€¢ Buzzer/Speaker              â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Motor Driver Boards      â”‚  â€¢ Emergency Stop Button      â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ Relay Modules (8ch)      â”‚  â€¢ Touch Screen Display       â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  â€¢ UPS Battery Backup       â”‚  â€¢ RFID Reader                 â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*Fig 1: MedyVend Complete System Architecture*

### ğŸ”§ Hardware Architecture Details

The MedyVend system has evolved through two distinct hardware platforms:

- **MedyVend v1**: Current production system based on ESP32 microcontroller
- **MedyVend v2**: Next-generation system in development based on Raspberry Pi 4

---

## ğŸš€ MedyVend v1 - ESP32-Based Architecture (Current Production)

### âš¡ **ESP32-WROOM-32D - Main Controller**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Raspberry Pi 4 (4GB RAM)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Operating System: Raspberry Pi OS (Debian-based)                   â”‚
â”‚  Architecture: ARM64 (Cortex-A72 Quad-core 1.5GHz)                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Application   â”‚  â”‚   Middleware    â”‚  â”‚   System        â”‚     â”‚
â”‚  â”‚   Layer         â”‚  â”‚   Layer         â”‚  â”‚   Services      â”‚     â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚     â”‚
â”‚  â”‚ â€¢ MedyVend App  â”‚  â”‚ â€¢ RabbitMQ      â”‚  â”‚ â€¢ Systemd       â”‚     â”‚
â”‚  â”‚ â€¢ Health Monitorâ”‚  â”‚   Client        â”‚  â”‚ â€¢ NetworkManagerâ”‚     â”‚
â”‚  â”‚ â€¢ Log Manager   â”‚  â”‚ â€¢ MQTT Broker   â”‚  â”‚ â€¢ SSH Daemon    â”‚     â”‚
â”‚  â”‚ â€¢ Update Serviceâ”‚  â”‚ â€¢ Redis Cache   â”‚  â”‚ â€¢ Cron Jobs     â”‚     â”‚
â”‚  â”‚ â€¢ Backup Agent  â”‚  â”‚ â€¢ Message Queue â”‚  â”‚ â€¢ Log Rotation  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Communication Interfaces                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  WiFi 802.11ac     â”‚  Ethernet          â”‚  USB 3.0 x4         â”‚ â”‚
â”‚  â”‚  Bluetooth 5.0     â”‚  GPIO 40-pin       â”‚  HDMI x2             â”‚ â”‚
â”‚  â”‚  Camera Interface  â”‚  I2C/SPI/UART      â”‚  Audio 3.5mm         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### âš¡ **ESP32 - Real-time Hardware Controller**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ESP32-WROOM-32D                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  CPU: Dual-core Xtensa LX6 @ 240MHz                                â”‚
â”‚  Memory: 520KB SRAM, 4MB Flash                                     â”‚
â”‚  Wireless: WiFi 802.11 b/g/n, Bluetooth 4.2                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Motor         â”‚  â”‚   Sensor        â”‚  â”‚   Communication â”‚     â”‚
â”‚  â”‚   Control       â”‚  â”‚   Interface     â”‚  â”‚   Module        â”‚     â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚     â”‚
â”‚  â”‚ â€¢ PWM Control   â”‚  â”‚ â€¢ ADC Readings  â”‚  â”‚ â€¢ WiFi Client   â”‚     â”‚
â”‚  â”‚ â€¢ Step Timing   â”‚  â”‚ â€¢ Digital I/O   â”‚  â”‚ â€¢ UART Bridge   â”‚     â”‚
â”‚  â”‚ â€¢ Direction     â”‚  â”‚ â€¢ Interrupt     â”‚  â”‚ â€¢ I2C Master    â”‚     â”‚
â”‚  â”‚   Control       â”‚  â”‚   Handling      â”‚  â”‚ â€¢ SPI Master    â”‚     â”‚
â”‚  â”‚ â€¢ Emergency     â”‚  â”‚ â€¢ Debouncing    â”‚  â”‚ â€¢ JSON Protocol â”‚     â”‚
â”‚  â”‚   Stop          â”‚  â”‚ â€¢ Calibration   â”‚  â”‚ â€¢ OTA Updates   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      GPIO Pin Allocation                        â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Motors (PWM):         â”‚  Sensors (ADC/Digital):               â”‚ â”‚
â”‚  â”‚  â€¢ GPIO 2,4,5,18,19    â”‚  â€¢ GPIO 32,33,34,35,36 (ADC)         â”‚ â”‚
â”‚  â”‚  â€¢ GPIO 21,22,23       â”‚  â€¢ GPIO 25,26,27 (Digital)           â”‚ â”‚
â”‚  â”‚                        â”‚  â€¢ GPIO 12,13,14,15 (Interrupts)     â”‚ â”‚
â”‚  â”‚  Communication:        â”‚  Control Signals:                    â”‚ â”‚
â”‚  â”‚  â€¢ GPIO 16,17 (UART)   â”‚  â€¢ GPIO 0 (Boot/Reset)               â”‚ â”‚
â”‚  â”‚  â€¢ GPIO 6,7,8,9,10,11  â”‚  â€¢ GPIO 1,3 (Debug UART)            â”‚ â”‚
â”‚  â”‚    (SPI Flash)         â”‚  â€¢ GPIO 39 (Input Only)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ **Communication Architecture**

#### ğŸ“¡ **RabbitMQ Message Broker Integration**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RabbitMQ Message Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Laravel API   â”‚    â”‚   RabbitMQ      â”‚    â”‚  MedyVend       â”‚ â”‚
â”‚  â”‚   Backend       â”‚    â”‚   Broker        â”‚    â”‚  Machine        â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ Publisher   â”‚â”€â”¼â”€â”€â”€â”€â”¼â†’â”‚ Exchange    â”‚ â”‚    â”‚ â”‚ Subscriber  â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ Service     â”‚ â”‚    â”‚ â”‚ (Direct)    â”‚ â”‚    â”‚ â”‚ Service     â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚        â”‚        â”‚    â”‚        â†‘        â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚        â†“        â”‚    â”‚        â”‚        â”‚ â”‚
â”‚  â”‚ â”‚ Consumer    â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ Service     â”‚â†â”¼â”€â”€â”€â”€â”¼â”€â”‚ Queue       â”‚â†â”¼â”€â”€â”€â”€â”¼â”€â”‚ Publisher   â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚ (Response)  â”‚ â”‚    â”‚ â”‚ Service     â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Message Types:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Command Messages (API â†’ Machine):                             â”‚ â”‚
â”‚  â”‚  â€¢ dispense_medicine    â€¢ check_inventory   â€¢ system_reset      â”‚ â”‚
â”‚  â”‚  â€¢ update_config        â€¢ run_diagnostics   â€¢ emergency_stop    â”‚ â”‚
â”‚  â”‚  â€¢ calibrate_sensors    â€¢ update_firmware   â€¢ maintenance_mode  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Status Messages (Machine â†’ API):                              â”‚ â”‚
â”‚  â”‚  â€¢ dispensing_complete  â€¢ sensor_reading    â€¢ error_report      â”‚ â”‚
â”‚  â”‚  â€¢ inventory_update     â€¢ heartbeat        â€¢ maintenance_alert  â”‚ â”‚
â”‚  â”‚  â€¢ door_status         â€¢ temperature       â€¢ power_status       â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Queue Configuration:                                          â”‚ â”‚
â”‚  â”‚  â€¢ Exchange: medyvend.direct                                   â”‚ â”‚
â”‚  â”‚  â€¢ Routing Keys: machine.{id}.command, machine.{id}.status     â”‚ â”‚
â”‚  â”‚  â€¢ Durability: Persistent queues for reliability               â”‚ â”‚
â”‚  â”‚  â€¢ TTL: 30 minutes for commands, 24 hours for status           â”‚ â”‚
â”‚  â”‚  â€¢ Dead Letter Queue: For failed message handling              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ› ï¸ **Hardware Control Flow**

#### âš™ï¸ **Medicine Dispensing Sequence**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Medicine Dispensing Hardware Flow                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 1: Command Reception                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RabbitMQ â†’ Raspberry Pi â†’ ESP32                               â”‚ â”‚
â”‚  â”‚  Message: {"action":"dispense","slot":"A1","quantity":2}        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â†“                                â”‚
â”‚  Step 2: Safety Checks                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Door Lock Status    â€¢ Emergency Stop   â€¢ Power Levels       â”‚ â”‚
â”‚  â”‚  â€¢ Slot Availability   â€¢ Weight Sensors   â€¢ Temperature        â”‚ â”‚
â”‚  â”‚  â€¢ System Health       â€¢ Error States     â€¢ Calibration        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â†“                                â”‚
â”‚  Step 3: Mechanical Sequence                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Position Stepper Motor â†’ Target Slot (Row/Column)             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ X-Axis Motor: Move to Column Position                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Y-Axis Motor: Move to Row Position                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Z-Axis Motor: Lower to Dispense Level                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Activate Dispensing Mechanism                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Solenoid Lock: Release Medicine Compartment               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Pusher Motor: Push Medicine Forward                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Drop Sensor: Detect Medicine Drop                         â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Return to Home Position                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Retract Pusher Mechanism                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Raise Z-Axis to Clear Position                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Return X,Y to Home (0,0)                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â†“                                â”‚
â”‚  Step 4: Verification & Feedback                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Weight Change Detection                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Before Weight: Load Cell Reading                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ After Weight: Load Cell Reading                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Difference: Confirm Medicine Dispensed                    â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Sensor Confirmations                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ IR Beam Break: Medicine Passed Through                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Drop Sensor: Medicine Reached Collection Area             â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Camera Verification: Visual Confirmation (Optional)       â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Status Reporting                                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Update Inventory Count                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Log Transaction                                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Send Completion Message to RabbitMQ                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š **Sensor & Monitoring Systems**

#### ğŸ” **Real-time Monitoring Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Sensor Monitoring System                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Environmental Monitoring:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Temperature & Humidity (DHT22)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Medicine Storage: 15-25Â°C, <60% RH                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Electronics Compartment: <40Â°C                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Alerts: Over-temperature, High Humidity                   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Power Monitoring (INA219)                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Main Power: 24V DC Supply Monitoring                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Battery Backup: UPS Status & Charge Level                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Power Consumption: Per-component Usage                    â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Vibration Detection (MPU6050)                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Tampering Detection: Unusual Movement                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Transport Monitoring: Excessive Vibration                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Maintenance Alerts: Component Wear                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Inventory Monitoring:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Weight Sensors (HX711 + Load Cells)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Per-Slot Weight Monitoring: 0.1g Precision                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Medicine Count Calculation: Weight-based Counting         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Theft Detection: Unexpected Weight Changes                â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  IR Slot Sensors (Photoelectric)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Slot Occupancy: Beam Break Detection                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Medicine Dispensing: Drop Confirmation                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Jam Detection: Stuck Medicine Alert                       â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Camera System (Pi Camera V2)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ QR Code Scanning: Patient/Medicine Verification           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Visual Inventory: Stock Level Confirmation                â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Security Recording: Dispensing Event Capture              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Security & Access Control:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Door Sensors (Reed Switch/Magnetic)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Main Access Door: Locked/Unlocked Status                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Medicine Compartment: Individual Slot Doors               â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Service Panel: Maintenance Access                         â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  RFID Access Control (RC522)                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Staff Authentication: Maintenance Access                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Patient Identification: Prescription Verification         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Audit Trail: Access Logging                               â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Emergency Systems                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Emergency Stop Button: Immediate System Halt              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Fire Sensor: Smoke/Heat Detection                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Panic Button: Silent Alarm Activation                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ **Software Stack & Communication Protocols**

#### ğŸ’» **Embedded Software Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Raspberry Pi Software Stack                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Operating System Layer:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Raspberry Pi OS (Debian 11 Bullseye)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Kernel: Linux 5.15.x ARM64                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Init System: systemd                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Package Manager: apt                                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Security: UFW Firewall, SSH Key Auth                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Application Layer (Python 3.9+):                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MedyVend Control Application                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Flask Web Server: Local API & Dashboard                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ RabbitMQ Client: pika library                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Database: SQLite for local storage                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ GPIO Control: RPi.GPIO library                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Serial Communication: PySerial for ESP32                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Camera Interface: picamera library                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Scheduling: APScheduler for tasks                         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Logging: structured JSON logs                             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Key Modules:                                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ machine_controller.py: Main control logic                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ rabbitmq_handler.py: Message queue interface             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ esp32_interface.py: Hardware communication               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ sensor_monitor.py: Sensor data collection                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ inventory_manager.py: Stock tracking                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ security_module.py: Access control & auth               â”‚ â”‚
â”‚  â”‚  â””â”€â”€ health_monitor.py: System health checks                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Service Layer:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Systemd Services:                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ medyvend-controller.service: Main application            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ medyvend-monitor.service: Health monitoring              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ medyvend-backup.service: Data backup                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€ medyvend-update.service: OTA updates                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Cron Jobs:                                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Health Reports: Every 5 minutes                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Inventory Sync: Every hour                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Log Rotation: Daily                                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ System Backup: Weekly                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ESP32 Firmware Stack                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Development Framework:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ESP-IDF (Espressif IoT Development Framework) v4.4             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ FreeRTOS: Real-time operating system                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ESP32 HAL: Hardware abstraction layer                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ WiFi Stack: 802.11 b/g/n support                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Bluetooth: Classic + BLE support                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ OTA Updates: Over-the-air firmware updates                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Application Tasks (FreeRTOS):                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Core Tasks:                                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ main_task: Primary control loop                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ comm_task: UART communication with Pi                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ motor_task: Stepper/servo motor control                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ sensor_task: ADC readings & sensor monitoring            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ safety_task: Emergency stop & safety systems             â”‚ â”‚
â”‚  â”‚  â””â”€â”€ watchdog_task: System health monitoring                  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Task Priorities:                                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ safety_task: Priority 5 (Highest)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ motor_task: Priority 4                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ sensor_task: Priority 3                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ comm_task: Priority 2                                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€ main_task: Priority 1                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Hardware Abstraction:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Driver Modules:                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ stepper_driver.c: Stepper motor control                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ servo_driver.c: Servo motor PWM control                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ sensor_driver.c: ADC & digital sensor interface          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ safety_driver.c: Emergency & safety systems              â”‚ â”‚
â”‚  â”‚  â””â”€â”€ comm_driver.c: UART protocol implementation              â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Configuration:                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ motor_config.h: Motor parameters & timing                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ sensor_config.h: Sensor calibration data                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ pin_config.h: GPIO pin assignments                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ system_config.h: System-wide settings                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¡ **Network & Communication Protocols**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Communication Protocol Stack                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Internet Layer:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Primary: WiFi 802.11n (2.4/5GHz)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ SSID: MedyVend_Network                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Security: WPA2-Enterprise                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ IP Assignment: DHCP with reservation                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Fallback: Mobile Hotspot (4G/5G)                          â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Backup: Ethernet (Wired)                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Connection: CAT6 cable                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Protocol: IEEE 802.3                                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€ PoE Support: Power over Ethernet capability               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Application Protocols:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RabbitMQ/AMQP 0.9.1:                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Server: medyvend-broker.example.com:5672                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Authentication: Username/Password + SSL/TLS               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Virtual Host: /medyvend                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Exchange: medyvend.direct (durable)                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Queues: machine.{id}.cmd, machine.{id}.status             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  HTTP/HTTPS (REST API):                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ VendTrails API: https://emapi.vendtrails.com              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Laravel Backend: https://api.medyvend.com                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Authentication: JWT tokens                                â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Rate Limiting: 100 requests/minute                        â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  MQTT (Alternative):                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Broker: medyvend-mqtt.example.com:8883                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Topics: medyvend/{id}/cmd, medyvend/{id}/status           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ QoS Level: 1 (At least once delivery)                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Retain: Status messages retained                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  Inter-Component Communication:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Raspberry Pi â†â†’ ESP32:                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Physical: UART (3.3V TTL)                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Baud Rate: 115200 bps                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Protocol: Custom JSON-based                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Flow Control: RTS/CTS hardware                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Error Handling: CRC checksum validation                   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  ESP32 â†â†’ Sensors/Motors:                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ I2C Bus: Temperature, humidity, IMU sensors               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ SPI Bus: High-speed ADCs, display modules                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ PWM Signals: Motor control (20kHz frequency)              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ GPIO: Digital sensors, switches, LEDs                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€ ADC: Analog sensors, voltage monitoring                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This comprehensive hardware architecture section provides complete technical details about:

1. **ğŸ–¥ï¸ Raspberry Pi Controller** - Main system coordination and network communication
2. **âš¡ ESP32 Microcontroller** - Real-time hardware control and sensor management  
3. **ğŸ“¡ RabbitMQ Integration** - Message queuing for reliable communication
4. **ğŸ”§ Hardware Components** - Motors, sensors, and control systems
5. **âš™ï¸ Control Flow** - Step-by-step dispensing sequence
6. **ğŸ“Š Monitoring Systems** - Environmental and security sensors
7. **ğŸ’» Software Stack** - Complete embedded software architecture
8. **ğŸ“¡ Communication Protocols** - Network and inter-component communication

The architecture shows how the ESP32 and Raspberry Pi work together with RabbitMQ to create a robust, real-time medicine dispensing system with comprehensive monitoring and fail-safe mechanisms.

---

## ğŸ’¡ Key Features

### ğŸ¥ Healthcare-Focused
- **Prescription Integration** - Links with doctor prescriptions and patient records
- **Expiry Management** - Automatic tracking and alerts for medication expiry
- **Batch Tracking** - Complete traceability from manufacturing to dispensing
- **Compliance Reporting** - Audit trails for regulatory compliance

### ğŸ¤– Smart Automation
- **AI-Powered Inventory** - Predictive restocking based on usage patterns
- **Real-time Monitoring** - Live machine status and health monitoring
- **Automatic Dispensing** - Queue-based processing with retry logic
- **Error Recovery** - Automatic fault detection and recovery procedures

### ğŸ“Š Analytics & Reporting
- **Usage Analytics** - Detailed reporting on dispensing patterns
- **Stock Optimization** - Data-driven inventory management
- **Performance Metrics** - Machine uptime and efficiency tracking
- **Financial Reports** - Revenue and transaction analysis

### ğŸ”’ Security & Compliance
- **Multi-level Authentication** - Role-based access control
- **Encrypted Communication** - Secure API communications
- **Audit Logging** - Comprehensive activity tracking
- **Data Privacy** - GDPR/HIPAA compliant data handling

---

## ğŸ”§ Technology Stack

### Backend
- **Framework**: Laravel 8.x
- **Language**: PHP 7.4+
- **Database**: MySQL 8.0+
- **Queue System**: Redis/Database
- **Caching**: Redis
- **API**: RESTful APIs with Sanctum authentication

### Frontend
- **Template Engine**: Laravel Blade
- **CSS Framework**: Bootstrap 5
- **JavaScript**: Vanilla JS + jQuery
- **Charts**: Chart.js
- **Icons**: FontAwesome 6

### DevOps & Infrastructure
- **Web Server**: Apache/Nginx
- **OS**: Ubuntu 22.04 LTS
- **Process Manager**: Supervisor
- **Monitoring**: Laravel Telescope
- **Logging**: Custom log channels

### Integrations
- **VendTrails API**: Hardware control and monitoring
- **Payment Gateways**: Multiple payment provider support
- **SMS/Email**: Notification services
- **ABDM Integration**: Healthcare record integration (future)

---

## ğŸ“Š Database Schema

```
[Database Schema Diagram Placeholder]
```

*Fig 3: Database Entity Relationship Diagram*

### Core Tables:

| Table | Purpose | Key Relationships |
|-------|---------|------------------|
| `vending_machine` | Machine registry and configuration | â†’ `vending_machine_inventory` |
| `drugs` | Master drug catalog | â†’ `vending_machine_inventory` |
| `vending_machine_inventory` | Stock levels and slot mapping | `vending_machine` â† â†’ `drugs` |
| `vending_dispense_records` | Dispensing transaction log | â†’ `vending_machine`, `drugs` |
| `users` | System users and authentication | â†’ `vending_dispense_records` |

### Sample Schema:

```sql
-- Vending Machine Configuration
CREATE TABLE vending_machine (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    machine_id VARCHAR(50) UNIQUE,
    machine_num INT UNIQUE,
    machine_name VARCHAR(255),
    machine_lat DECIMAL(10,7),
    machine_long DECIMAL(10,7),
    machine_is_active BOOLEAN DEFAULT TRUE,
    machine_last_ping TIMESTAMP,
    vendtrails_access_token TEXT,
    vendtrails_refresh_token TEXT,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- Drug Master Data
CREATE TABLE drugs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255),
    generic_name VARCHAR(255),
    manufacturer VARCHAR(255),
    category VARCHAR(100),
    strength VARCHAR(50),
    price DECIMAL(10,2),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- Inventory Management
CREATE TABLE vending_machine_inventory (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    vending_machine_id BIGINT,
    drug_id BIGINT,
    slot_row INT,
    slot_column INT,
    stock_quantity INT DEFAULT 0,
    threshold_quantity INT,
    expiry_date DATE,
    batch_number VARCHAR(100),
    last_restocked_at TIMESTAMP,
    FOREIGN KEY (vending_machine_id) REFERENCES vending_machine(id),
    FOREIGN KEY (drug_id) REFERENCES drugs(id),
    UNIQUE KEY unique_machine_slot (vending_machine_id, slot_row, slot_column)
);
```

---

## ğŸš€ Quick Start

### Prerequisites
- PHP 7.4 or higher
- Composer
- MySQL 8.0+
- Node.js & NPM (for asset compilation)
- Redis (recommended for queues)

### Installation

1. **Clone the Repository**
   ```bash
   git clone https://github.com/your-org/medyvend-poc.git
   cd medyvend-poc
   ```

2. **Install Dependencies**
   ```bash
   # Backend dependencies
   composer install
   
   # Frontend dependencies (if using Laravel Mix)
   npm install
   ```

3. **Environment Setup**
   ```bash
   # Copy environment file
   cp .env.example .env
   
   # Generate application key
   php artisan key:generate
   
   # Configure database in .env file
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=vending_poc
   DB_USERNAME=root
   DB_PASSWORD=your_password
   ```

4. **Database Setup**
   ```bash
   # Create database
   mysql -u root -p -e "CREATE DATABASE vending_poc;"
   
   # Run migrations
   php artisan migrate
   
   # Seed sample data
   php artisan db:seed --class=VendingSystemSeeder
   ```

5. **Queue Configuration**
   ```bash
   # For production, use Redis
   QUEUE_CONNECTION=redis
   
   # For development, use database
   QUEUE_CONNECTION=database
   php artisan queue:table
   php artisan migrate
   ```

6. **Start the Application**
   ```bash
   # Development server
   php artisan serve
   
   # Queue worker (separate terminal)
   php artisan queue:work
   
   # Schedule runner (for cron jobs)
   php artisan schedule:run
   ```

### First Login
- **URL**: `http://localhost:8000/admin/dashboard`
- **Default Admin**: admin@medyvend.com / password123

---

## ğŸ“ Project Structure

```
medyvend-poc/
â”œâ”€â”€ ğŸ“ app/
â”‚   â”œâ”€â”€ ğŸ“ Http/Controllers/
â”‚   â”‚   â”œâ”€â”€ VendingMachineController.php     # Machine CRUD & operations
â”‚   â”‚   â””â”€â”€ VendingInventoryController.php   # Inventory management
â”‚   â”œâ”€â”€ ğŸ“ Models/
â”‚   â”‚   â”œâ”€â”€ VendingMachine.php               # Machine model
â”‚   â”‚   â”œâ”€â”€ VendingMachineInventory.php      # Inventory model
â”‚   â”‚   â”œâ”€â”€ VendingDispenseRecord.php        # Transaction model
â”‚   â”‚   â””â”€â”€ Drug.php                         # Drug master model
â”‚   â”œâ”€â”€ ğŸ“ Services/
â”‚   â”‚   â””â”€â”€ VendTrailsService.php            # VendTrails API integration
â”‚   â”œâ”€â”€ ğŸ“ Jobs/
â”‚   â”‚   â”œâ”€â”€ DispatchMedsToVendtrails.php     # Async dispensing job
â”‚   â”‚   â””â”€â”€ CheckVendtrailsTaskStatus.php    # Status monitoring job
â”‚   â””â”€â”€ ğŸ“ Providers/
â”‚       â””â”€â”€ VendingServiceProvider.php       # Service bindings
â”œâ”€â”€ ğŸ“ resources/views/
â”‚   â”œâ”€â”€ ğŸ“ layouts/
â”‚   â”‚   â””â”€â”€ admin.blade.php                  # Admin layout template
â”‚   â””â”€â”€ ğŸ“ admin/
â”‚       â”œâ”€â”€ dashboard.blade.php              # Main dashboard
â”‚       â”œâ”€â”€ ğŸ“ machines/
â”‚       â”‚   â””â”€â”€ index.blade.php              # Machine management
â”‚       â””â”€â”€ ğŸ“ inventory/
â”‚           â””â”€â”€ index.blade.php              # Inventory management
â”œâ”€â”€ ğŸ“ database/
â”‚   â”œâ”€â”€ ğŸ“ migrations/                       # Database schema
â”‚   â””â”€â”€ ğŸ“ seeders/
â”‚       â””â”€â”€ VendingSystemSeeder.php          # Sample data
â”œâ”€â”€ ğŸ“ routes/
â”‚   â”œâ”€â”€ web.php                              # Web interface routes
â”‚   â””â”€â”€ api.php                              # API routes (v1 & v2)
â”œâ”€â”€ ğŸ“ config/
â”‚   â””â”€â”€ logging.php                          # Custom log channels
â””â”€â”€ ğŸ“ storage/logs/
    â””â”€â”€ vending_trails.log                   # VendTrails specific logs
```

---

## ğŸ”Œ API Documentation

### Base URLs
- **V1 API**: `/api/v1/vending/`
- **V2 API**: `/api/v2/vending/`

### Authentication
```http
Authorization: Bearer {your-api-token}
Content-Type: application/json
```

### Core Endpoints

#### Machine Operations
```http
POST /api/v2/vending/generate-token
POST /api/v2/vending/machine-details
POST /api/v2/vending/send-instruction
POST /api/v2/vending/check-status
POST /api/v2/vending/hard-reset
```

#### Inventory Management
```http
GET    /api/v2/vending/inventory           # List inventory
POST   /api/v2/vending/inventory           # Add inventory item
GET    /api/v2/vending/inventory/{id}      # Get specific item
PUT    /api/v2/vending/inventory/{id}      # Update inventory
DELETE /api/v2/vending/inventory/{id}      # Remove item
```

#### Medicine Dispensing
```http
GET  /api/v2/vending/get/meds             # Get available medicines
POST /api/v2/vending/dispense-meds        # Dispense medicines
```

### Sample API Calls

#### Dispense Medicine
```bash
curl -X POST "http://localhost:8000/api/v2/vending/dispense-meds" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-token" \
  -d '{
    "prescription_id": 12345,
    "invoice_id": 67890,
    "selected_tablets": [
      {"drug_id": 1, "quantity": 2},
      {"drug_id": 3, "quantity": 1}
    ],
    "transaction_ref": "TXN123456789",
    "machine_id": 1
  }'
```

#### Check Machine Status
```bash
curl -X POST "http://localhost:8000/api/v2/vending/check-status" \
  -H "Content-Type: application/json" \
  -d '{
    "task_num": 12345,
    "machine_num": 1
  }'
```

---

## âš¡ Core Components

### VendingMachineController
Handles all machine-related operations including:
- Machine registration and configuration
- Token generation and refresh
- Hardware communication via VendTrails
- Machine status monitoring
- Hard reset operations

### VendingInventoryController
Manages inventory operations:
- Stock level tracking
- Low stock alerts
- Expiry date monitoring
- Batch number tracking
- CRUD operations for inventory items

### VendTrailsService
Core integration service for hardware communication:
- Secure API communication
- Automatic token refresh
- Error handling and retry logic
- Task status monitoring
- Machine instruction dispatch

### Background Jobs
Asynchronous processing for:
- Medicine dispensing operations
- Status monitoring and polling
- Inventory updates
- Alert notifications
- Report generation

---

## ğŸ“ˆ Data Flow

### Medicine Dispensing Workflow

```
[Dispensing Flow Diagram Placeholder]
```

*Fig 4: Medicine Dispensing Process Flow*

1. **Prescription Creation** - Doctor creates prescription for patient
2. **Invoice Generation** - System generates billing invoice
3. **Dispensing Request** - Medicine dispensing request initiated
4. **Slot Mapping** - System maps drugs to vending machine slots
5. **Queue Processing** - Background job processes dispensing request
6. **Hardware Communication** - API call sent to VendTrails service
7. **Machine Operation** - Physical dispensing from machine
8. **Status Monitoring** - System polls for completion status
9. **Transaction Recording** - Success/failure recorded in database
10. **Inventory Update** - Stock levels automatically updated
11. **Notification** - Patient/staff notified of completion

### Inventory Management Flow

```
[Inventory Flow Diagram Placeholder]
```

*Fig 5: Inventory Management Process*

1. **Stock Monitoring** - Continuous tracking of inventory levels
2. **Threshold Alerts** - Automatic low stock notifications
3. **Restocking Process** - Manual or automated restocking
4. **Expiry Tracking** - Monitor medication expiry dates
5. **Batch Management** - Track batch numbers for recalls
6. **Audit Trail** - Complete history of inventory changes

---

## ğŸ” Security Features

### Authentication & Authorization
- **Multi-factor Authentication** - Enhanced security for admin access
- **Role-based Access Control** - Granular permissions system
- **API Token Management** - Secure token generation and rotation
- **Session Management** - Secure session handling

### Data Protection
- **Encryption at Rest** - Database encryption for sensitive data
- **Encryption in Transit** - TLS/SSL for all communications
- **API Security** - Rate limiting and request validation
- **Audit Logging** - Comprehensive activity tracking

### Compliance
- **GDPR Compliance** - Data privacy and protection
- **HIPAA Ready** - Healthcare data security standards
- **FDA Compliance** - Pharmaceutical traceability requirements
- **Local Regulations** - Adaptable to regional requirements

---

## ğŸ› ï¸ Configuration

### Environment Variables
```bash
# Application
APP_NAME="MedyVend"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

# Database
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=vending_poc
DB_USERNAME=vending_user
DB_PASSWORD=secure_password

# Queue Configuration
QUEUE_CONNECTION=redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# VendTrails Integration
VENDTRAILS_API_URL=https://emapi.vendtrails.com/api
VENDTRAILS_COMPANY_NUM=2

# Logging
LOG_CHANNEL=stack
LOG_LEVEL=info
```

---

## ğŸ“± Frontend Interface

### Dashboard Features
- **Real-time Statistics** - Live machine and inventory stats
- **Machine Status Grid** - Visual status of all machines
- **Dispensing Activity** - Recent transactions and trends
- **Alert Center** - Critical notifications and warnings
- **Analytics Charts** - Usage patterns and performance metrics

### Machine Management
- **Machine Registry** - Add, edit, and configure machines
- **Status Monitoring** - Real-time machine health
- **Remote Operations** - Test connections and reset machines
- **Configuration** - Update machine settings and parameters

### Inventory Control
- **Stock Overview** - Current inventory levels across machines
- **Restocking Interface** - Easy stock management tools
- **Expiry Alerts** - Medication expiry monitoring
- **Batch Tracking** - Complete batch traceability
- **Reports** - Comprehensive inventory reports

### User Interface Screenshots
```
[Dashboard Screenshot Placeholder]
[Machine Management Screenshot Placeholder]
[Inventory Management Screenshot Placeholder]
```

---

## ğŸ”„ Background Processing

### Job Queue System
The system uses Laravel's queue system for asynchronous processing:

#### DispatchMedsToVendtrails Job
- **Purpose**: Handle medicine dispensing requests
- **Processing**: Communicates with VendTrails API
- **Retry Logic**: 3 attempts with exponential backoff
- **Error Handling**: Comprehensive error logging and alerting

#### CheckVendtrailsTaskStatus Job
- **Purpose**: Monitor dispensing task completion
- **Polling**: Automatic status checking every 30 seconds
- **Completion**: Updates records and inventory on success
- **Timeout**: Handles failed or stuck tasks

### Queue Workers
```bash
# Start queue workers
php artisan queue:work --queue=vending --tries=3 --timeout=300

# Monitor queue status
php artisan queue:monitor vending

# Clear failed jobs
php artisan queue:flush
```

---

## ğŸ“Š Monitoring & Analytics

### Performance Monitoring
- **Response Times** - API and web interface performance
- **Queue Processing** - Job completion times and failure rates
- **Database Performance** - Query optimization and indexing
- **Machine Uptime** - Hardware availability tracking

### Business Analytics
- **Usage Patterns** - Peak hours and demand forecasting
- **Inventory Turnover** - Stock rotation and optimization
- **Revenue Analytics** - Financial performance tracking
- **Patient Satisfaction** - Service quality metrics

---

## ğŸ§ª Testing

### Test Structure
```
tests/
â”œâ”€â”€ Feature/
â”‚   â”œâ”€â”€ VendingMachineTest.php
â”‚   â”œâ”€â”€ InventoryManagementTest.php
â”‚   â””â”€â”€ DispensingWorkflowTest.php
â”œâ”€â”€ Unit/
â”‚   â”œâ”€â”€ VendTrailsServiceTest.php
â”‚   â”œâ”€â”€ ModelTest.php
â”‚   â””â”€â”€ JobTest.php
â””â”€â”€ Integration/
    â””â”€â”€ VendTrailsIntegrationTest.php
```

### Running Tests
```bash
# Run all tests
php artisan test

# Run specific test suite
php artisan test --testsuite=Feature

# Run with coverage
php artisan test --coverage
```

---

## ğŸ“¦ Deployment

### Production Environment Setup

#### Server Requirements
- **OS**: Ubuntu 22.04 LTS or CentOS 8
- **Web Server**: Nginx or Apache 2.4+
- **PHP**: 7.4+ with extensions
- **Database**: MySQL 8.0+ or MariaDB 10.4+
- **Cache**: Redis 6.0+
- **Process Manager**: Supervisor for queue workers

#### Deployment Script
```bash
#!/bin/bash
# deploy.sh - Production deployment script

# Pull latest code
git pull origin main

# Update dependencies
composer install --optimize-autoloader --no-dev

# Clear and cache config
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Run migrations
php artisan migrate --force

# Restart queue workers
sudo supervisorctl restart laravel-worker:*

# Reload web server
sudo systemctl reload nginx
```

---

## ğŸ” Troubleshooting

### Common Issues

#### Queue Jobs Not Processing
```bash
# Check queue status
php artisan queue:monitor

# Restart queue workers
php artisan queue:restart

# Check failed jobs
php artisan queue:failed
```

#### VendTrails API Connection Issues
```bash
# Check VendTrails service logs
tail -f storage/logs/vending_trails.log

# Test API connectivity
curl -X POST "https://emapi.vendtrails.com/api/generate_token" \
  -d "company_num=2"
```

---

## ğŸ¤ Contributing

We welcome contributions to MedyVend! Please follow these guidelines:

### Development Workflow
1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass (`php artisan test`)
6. Commit your changes (`git commit -am 'Add amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Create a Pull Request

---

## ğŸ“œ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## ğŸ‘¥ Support

### Community
- **GitHub Discussions**: [GitHub Issues](https://github.com/medyvend/discussions)
- **Documentation**: Complete API and user documentation
- **Video Tutorials**: Step-by-step implementation guides

### Professional Support
- **Technical Support**: support@medyvend.com
- **Sales Inquiries**: sales@medyvend.com
- **Partnership**: partners@medyvend.com

---

**Made with â¤ï¸ by the MedyVend Team**

*Revolutionizing healthcare through intelligent automation*

---

*This README was last updated on: December 2024*
*For the most current information, please visit our documentation site*
